#include <Windows.h>
#include <cstdio>

#pragma comment(lib, "user32.lib")

int main(int argc, char *argv[]){
	if(argc != 2){
		printf("\nUsage: \n%s <process ID>\n\n", argv[0]);
	} else {
		int pid = atoi(argv[1]);
		char dllPath[] = "C:\\Users\\N3r0\\Documents\\Malw\\Debugger\\IsDebuggerPresentDLL.dll";
		HANDLE pHandle = OpenProcess(PROCESS_ALL_ACCESS, NULL, pid);
		if(pHandle) printf("Process opened!");
		LPVOID buffer = VirtualAllocEx(pHandle, NULL, sizeof(dllPath), MEM_COMMIT, PAGE_EXECUTE_READWRITE);
		if(buffer) printf("BufferAllocated! %p\n", buffer);
		if(WriteProcessMemory(pHandle, buffer, (LPVOID)dllPath, sizeof(dllPath), NULL)) printf("Writing Path of DLL to memory.\n");

		LPTHREAD_START_ROUTINE Threat_Start = (LPTHREAD_START_ROUTINE) GetProcAddress(LoadLibraryA(TEXT("Kernel32.dll")), "LoadLibraryA");

		if(!CreateRemoteThread(pHandle, NULL, sizeof(dllPath), Threat_Start, buffer, 0, NULL)){
			printf("CreateRemoteThread Error! %d", GetLastError());
		}
	}
	return 0;
}
